---
sidebar_position: 4
---

# 스레드

스레드는 프로세스의 실행 가능한 가장 작은 단위입니다. 하나의 프로세스는 여러 개의 스레드를 가질 수 있습니다.
프로세스는 코드, 데이터, 스택, 힙을 각각 생성하지만, 스레드는 코드, 데이터, 힙을 서로 공유하며, 스택과 레지스터만 개별적으로 가집니다

## 멀티스레딩
멀티스레딩은 하나의 프로세스 내에서 여러 개의 스레드를 사용하여 작업을 병렬적으로 처리하는 기법입니다. 스레드 간 자원을 공유하기 때문에 효율성이 높아지고, 동시성이 향상됩니다.

예를 들어, 웹 서버는 새로운 요청을 처리할 때마다 별도의 프로세스를 생성하는 대신 스레드를 활용하여 자원을 절약할 수 있습니다. 또한 한 스레드가 중단되더라도 다른 스레드는 계속 실행될 수 있어 보다 안정적인 처리가 가능합니다. 하지만, 하나의 스레드에 문제가 생기면 다른 스레드에도 영향을 미칠 수 있어 신중한 설계가 필요합니다.

:::note 동시성
서로 독립적인 작업들을 작은 단위로 나누어 마치 동시에 실행되는 것처럼 보이게 하는 기법.
:::
멀티스레드의 예로는 웹 브라우저의 렌더러 프로세스를 들 수 있습니다.

## 공유 자원과 임계 영역
### 공유 자원
공유 자원이란 시스템 내에서 여러 프로세스 또는 스레드가 접근할 수 있는 자원(예: 프린터, 메모리, 파일, 변수 등)을 의미합니다. 두 개 이상의 프로세스가 동시에 공유 자원에 접근하는 상황을 **경쟁 상태(Race Condition)** 라고 하며, 이로 인해 실행 순서에 따라 결괏값이 달라질 수 있습니다.

### 임계 영역
공유 자원에 접근할 때 실행 순서에 따라 결과가 달라지는 코드 영역을 **임계 영역(Critical Section)**이라고 합니다. 임계 영역을 보호하기 위해 동기화 기법을 사용하며, 대표적인 방법으로 <u>뮤텍스(Mutex), 세마포어(Semaphore), 모니터(Monitor)</u>가 있습니다.

:::tip 동기화 조건
- **상호 배제** : 한 프로세스가 임계 영역에 들어갔을 때 다른 프로세스는 들어갈 수 없다.
- **한정 대기** : 특정 프로세스가 임계 영역에 들어가지 못하면 안 된다.
- **융통성** : 한 프로세스가 다른 프로세스의 일을 방해해서는 안 된다.
:::

### 동기화 기법

#### 뮤텍스
뮤텍스는 하나의 스레드만이 공유 자원에 접근할 수 있도록 하는 잠금(lock) 방식입니다. 한 스레드가 뮤텍스를 획득하면 다른 스레드는 접근할 수 없습니다.

#### 세마포어
세마포어는 일반적인 형태의 뮤텍스로, 정수 값을 기반으로 접근을 제어합니다.
- 바이너리 세마포어(Binary Semaphore): 0과 1의 값만 가질 수 있으며, 뮤텍스와 유사하게 동작합니다.
- 카운팅 세마포어(Counting Semaphore): 여러 개의 스레드가 접근할 수 있도록 허용하며, 정수 값을 통해 접근 가능 여부를 결정합니다.
세마포어에는 두 가지 주요 연산이 있습니다.
- wait(): 공유 자원을 사용하려는 스레드는 세마포어 값을 감소시키며, 값이 0이면 대기 상태에 놓입니다.
- signal(): 공유 자원의 사용을 마친 후 세마포어 값을 증가시켜 대기 중인 스레드가 자원을 사용할 수 있도록 합니다.

**모니터(Monitor)**  
모니터는 공유 자원에 대한 접근을 캡슐화하여 안전한 접근을 보장하는 동기화 기법입니다. 모니터 내부에서만 공유 자원에 접근할 수 있으며, 내부에서 락을 자동으로 관리합니다.

## 교착 상태(deadlock)

### 교착 상태란?
두 개 이상의 프로세스가 서로가 가진 자원을 기다리면서 무한히 대기하는 상태를 **교착 상태(Deadlock)** 라고 합니다.

### 교착 상태 발생 조건 (Coffman’s Conditions)
1. **상호 배제(Mutual Exclusion)**: 한 프로세스가 자원을 독점하고 있으며, 다른 프로세스는 접근할 수 없음.
2. **점유 대기(Hold and Wait)**: 특정 프로세스가 일부 자원을 점유한 상태에서 추가 자원을 요청함.
3. **비선점(No Preemption)**: 프로세스가 점유한 자원을 강제로 빼앗을 수 없음.
4. **환형 대기(Circular Wait)**: 프로세스 간 자원 점유 관계가 원형을 이루어 서로가 서로의 자원을 기다리는 상황.

### 교착 상태 해결 방법
1. **예방(Prevention)**: 교착 상태 발생 조건 중 하나라도 충족되지 않도록 시스템을 설계.
2. **회피(Avoidance)**: 자원 할당 시 교착 상태 발생 가능성을 검사하여 안전한 경우에만 할당 (ex: 은행원 알고리즘(Banker's Algorithm)).
3. **탐지(Detection)** 및 복구(Recovery): 교착 상태가 발생하면 이를 탐지하고 관련된 프로세스를 종료하거나 자원을 강제로 회수하여 해결.
4. **무시(Ignoring)**: 교착 상태가 드물게 발생하므로, 이를 해결하는 비용이 더 크다고 판단하여 무시 (현대 운영체제가 주로 사용하는 방식).

:::note 은행원 알고리즘
총 자원의 양과 현재 할당된 자원의 양을 기반으로 시스템이 안정 상태(Safe State)인지 판별하고, 안전한 경우에만 자원을 할당하는 알고리즘.
:::

