---
sidebar_position: 2
---

# TCP/IP

인터넷 프로토콜 스위트는 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집합이며, 이를 TCP/IP 4계층 모델을 중심으로 설명합니다. 이 계층 모델은 네트워크에서 사용되는 통신 프로토콜의 집합으로, 계층들은 프로토콜의 네트워킹 범위에 따라 4개의 추상화 계층으로 구성됩니다.

## 계층 구조
TCP/IP 계층은 4개의 계층을 가지고 있으며 OSI 7계층과 많이 비교합니다.
![TCP/IP](/img/tcpip.jpg)

TCP/IP 계층과 달리 OSI 계층은 애플리케이션 계층을 세 개로 나누고, 링크 계층을 데이터 링크 계층과 물리 계층으로 구분하여 표현한다는 점이 다릅니다. 또한, 인터넷 계층을 네트워크 계층으로 부른다는 차이가 있습니다.

이 계층들은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 설계되었습니다. 예를 들어, 전송 계층에서 TCP를 UDP로 변경하더라도 인터넷 웹 브라우저를 다시 설치해야 하는 것은 아니도록 설계되어 있습니다.

### 애플리케이션 계층
애플리케이션 계층은 FTP, HTTP, SSH, SMTP, DNS 등과 같은 응용 프로그램이 사용하는 프로토콜 계층입니다. 웹 서비스, 이메일 등 사용자에게 실질적인 서비스를 제공하는 역할을 합니다.

1. FTP (File Transfer Protocol): 장치 간의 파일 전송을 위한 표준 통신 프로토콜
2. SSH (Secure Shell): 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
3. HTTP (HyperText Transfer Protocol): 웹사이트를 이용하는 데 사용되는 데이터 통신 프로토콜
4. SMTP (Simple Mail Transfer Protocol): 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
5. DNS (Domain Name System): 도메인 이름과 IP 주소를 매핑해주는 서버


### 전송 계층
전송 계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하며, 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 등의 기능을 수행합니다. 이 계층은 애플리케이션과 인터넷 계층 사이에서 데이터가 전달될 때 중계 역할을 합니다.

#### TCP (Transmission Control Protocol)
TCP는 신뢰성이 필요한 연결에서 사용되며, 패킷의 순서를 보장하고 연결 지향 프로토콜을 사용하여 데이터 수신 여부를 확인합니다.

**TCP 연결 성립 과정 (3-Way Handshake)**  
1. SYN 단계: 클라이언트 → 서버로 연결 요청 (SYN 패킷 전송)
2. SYN + ACK 단계: 서버 → 클라이언트로 응답 (SYN + ACK 패킷 전송)
3. ACK 단계: 클라이언트 → 서버로 연결 확인 (ACK 패킷 전송)

**TCP 연결 해제 과정 (4-Way Handshake)**
1. 클라이언트 → 서버로 연결 종료 요청 (FIN 패킷 전송)
2. 서버 → 클라이언트로 확인 응답 (ACK 패킷 전송)
3. 서버 → 클라이언트로 종료 요청 (FIN 패킷 전송)
4. 클라이언트 → 서버로 종료 확인 (ACK 패킷 전송 후 종료)

:::note TIME_WAIT 상태
소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태로, 지연 패킷 처리 및 연결 안정성을 보장합니다.
:::

#### UDP (User Datagram Protocol)
UDP는 TCP와 달리 패킷의 순서를 보장하지 않고, 단순한 데이터 전송을 목적으로 합니다. 신뢰성이 보장되지 않지만 속도가 빠른 특징이 있습니다.

### 인터넷 계층
인터넷 계층은 네트워크 패킷을 목적지 IP 주소로 전송하는 역할을 합니다. 대표적인 프로토콜로 IP (Internet Protocol), ARP (Address Resolution Protocol), ICMP (Internet Control Message Protocol) 등이 있습니다.


### 링크 계층
링크 계층은 장치 간 물리적인 데이터 전송을 담당하며, 네트워크 접근 규칙을 정의합니다. 이를 물리 계층과 데이터 링크 계층으로 나누기도 합니다.

### 이더넷 프레임
데이터 링크 계층은 이더넷 프레임을 통해 전달받은 데이터의 에러를 검출하고 캡슐화하며 다음과 같은 구조를 가집니다.

![이더넷 프레임](/img/ethernet.jpeg)
- Preamble: 이더넷의 시작을 알림
- SFD: 다음 바이트부터 MAC 주소 필드가 시작됨을 알립니다.
- DMAC, SMAC: 수신, 송신 MAC 주소를 말합니다.
- EtherType: 데이터 계층 위의 계층인 IP 프로토콜을 정의합니다. 예를 들어 IPv4 또는 IPv6가 됩니다.
- Payload: 전달받은 데이터
- CRC: 에러 확인 비트

:::note MAC 주소
컴퓨터나 노트북 등 각 장치에는 네트워크에 연결하기 위한 장치가 있는데, 이를 구별하기 위한 식별번호를 말합니다. 6바이트로 구성됩니다.
:::

#### 유선 LAN (Ethernet)
유선 LAN은 IEEE 802.3 표준을 따르며, 데이터를 송수신하는 방식으로 전이중화 통신을 사용합니다.

**전이중화 통신**  
- 송신과 수신을 동시에 수행하는 방식
- 현대의 고속 이더넷 환경에서 기본적으로 사용됨

**반이중화 통신 (Half Duplex)**  
- 송신과 수신을 동시에 할 수 없는 방식
- 예전의 CSMA/CD (Carrier Sense Multiple Access with Collision Detection) 방식 사용

#### 무선 LAN (Wi-Fi)
무선 LAN은 IEEE 802.11 표준을 기반으로 하며, 데이터를 송신하기 전 CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance) 방식을 사용하여 충돌을 방지합니다.
xx
**주요 주파수 대역**  
- 2.4GHz 대역: 장애물에 강하지만 전파 간섭 발생 가능
- 5GHz 대역: 전파 간섭이 적고 빠른 속도를 제공하지만 장애물에 취약함

### 데이터 송수신 과정 
#### 캡슐화 과정
캡슐화는 상위 계층의 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정입니다.
1. 애플리케이션 계층: 사용자 요청 생성
2. 전송 계층: TCP/UDP 헤더 추가
3. 인터넷 계층: IP 헤더 추가
4. 링크 계층: MAC 주소를 포함한 프레임 생성 후 전송

#### 비캡슐화 과정
비캡슐화는 수신 측에서 반대로 각 계층별 헤더를 제거하면서 데이터를 원래의 애플리케이션으로 전달하는 과정입니다.
1. 링크 계층: 이더넷 프레임 해제 및 MAC 주소 확인
2. 인터넷 계층: IP 헤더 해제 후 목적지 확인
3. 전송 계층: TCP/UDP 헤더 해제 후 데이터 추출
4. 애플리케이션 계층: 사용자에게 데이터 제공


## PDU
네트워크에서 데이터가 각 계층을 따라 전달될 때, 각 계층에서 처리되는 데이터의 단위를 PDU (Protocol Data Unit)라고 합니다.
PDU는 헤더(Header)와 페이로드(Payload), 데이터 본문로 구성되며, 계층마다 PDU를 부르는 명칭이 다릅니다.
### 계층별 PDU 명칭
- 애플리케이션 계층: 메시지(Message)
    - 사용자가 실제로 전송하는 데이터(예: HTTP 요청, 이메일, 파일 전송 데이터)
- 전송 계층
    - 세그먼트(Segment) (TCP 사용 시)
    - 데이터그램(Datagram) (UDP 사용 시)
    - 데이터의 신뢰성 보장을 위한 TCP 헤더 또는 빠른 전송을 위한 UDP 헤더를 포함
- 인터넷 계층: 패킷(Packet)
    - 목적지 IP 주소를 포함하여 네트워크를 통해 올바르게 전달되도록 하는 단위
- 링크 계층
    - 프레임(Frame): 데이터 링크 계층에서 MAC 주소를 이용하여 장치 간 전달
    - 비트(Bit): 물리 계층에서 0과 1로 변환되어 전기 신호, 광 신호 등으로 전송